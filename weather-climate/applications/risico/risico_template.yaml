tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: Risico
  template_version: 0.1.0-SNAPSHOT
  template_author: lexis

description: RISICO template

imports:
  - yorc-types:1.1.0
  - tosca-normative-types:1.0.0-ALIEN20
  - docker-types:3.0.0
  - alien-base-types:3.0.0
  - heappe-types:1.0.2
  - ddi-types:0.1.2
  - org.ystia.docker.containers.docker.generic:3.0.0-SNAPSHOT
  - org.ystia.docker.ansible:3.0.0-SNAPSHOT
  - org.lexis.common.datatransfer:0.1.2-SNAPSHOT
  - org.lexis.weather.wps:0.1.1-SNAPSHOT
  - org.lexis.weather.webdrops:0.1.0

topology_template:
  inputs:
    token:
      type: string
      required: true
      description: "Access token"
    preprocessing_start_date:
      type: string
      description: Download GFS files from this date, format YYYYMMDDHH
      required: true
    preprocessing_end_date:
      type: string
      description: Download GFS files up to this date, format YYYYMMDDHH
      required: true
    postprocessing_risico_run_date:
      type: string
      description: RISICO run date, format YYYYMMDD
      required: true
    preprocessing_image:
      type: string
      description: Pre-processing container repository path
      default: "laurentg/wps.gfs:0.4.2"
      required: false
    preprocessing_volumes:
      type: list
      entry_schema:
        type: string
      description: |
        List of volumes to mount within the pre-processing container.
        Use docker CLI-style syntax: /host:/container[:mode]
      default: ["/wps_data/gfs:/input", "/wps_data/output:/output", "/wps_data/geog/WPS_GEOG:/geogrid"]
      required: false
#    preprocessing_environment_variables:
#      type: map
#      entry_schema:
#        type: string
#      description: |
#        Environment variables for the pre-processing container.
      # default: {WPS_START_DATE: "2020030112", WPS_END_DATE: "2020030115"}
#      required: false
    preprocessing_output_directory:
      type: string
      description: Directory where preprocessing results will be stored
      default: /wps_data/output
      required: false
    postprocessing_image:
      type: string
      description: Post-processing container repository path
      default: "laurentg/risico:0.3.1"
      required: false
    postprocessing_input_directory:
      type: string
      description: Directory where postprocessing data will be stored
      default: /risico_data/
      required: false
    postprocessing_volumes:
      type: list
      entry_schema:
        type: string
      description: |
        List of volumes to mount within the post-processing container.
        Use docker CLI-style syntax: /host:/container[:mode]
      default: ["/risico_data/:/home/risico/data"]
      required: false
    postprocessing_environment_variables:
      type: map
      entry_schema:
        type: string
      description: |
        Environment variables for the pre-processing container.
      # default: { RISICO_RUN_DATE: "202003010000" }
      required: false
    postprocessing_ddi_path:
      type: string
      description: "Path where to transfer the post-processing results in DDI"
      default: "project/wp7"
      required: false
  node_templates:
    PublicNet:
      type: tosca.nodes.Network
      properties:
        ip_version: 4
    RisicoVM:
      type: tosca.nodes.Compute
      requirements:
        - networkPublicNetConnection:
            type_requirement: network
            node: PublicNet
            capability: tosca.capabilities.Connectivity
            relationship: tosca.relationships.Network
      capabilities:
        host:
          properties:
            num_cpus: 10
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
        endpoint:
          properties:
            secure: true
            protocol: tcp
            network_name: PRIVATE
            initiator: source
    Docker:
      type: org.ystia.docker.ansible.nodes.Docker
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    CreatePreProcessDirs:
      type: org.lexis.datatransfer.nodes.CreateDirectories
      properties:
        directories: {get_input: preprocessing_volumes}
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    CreatePostProcessDirs:
      type: org.lexis.datatransfer.nodes.CreateDirectories
      properties:
        directories: {concat: ["[\"", get_input: postprocessing_input_directory, "/wrf\", \"", get_input: postprocessing_input_directory, "/output\"]"]}
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    WPS_GFS:
      type: org.ystia.docker.containers.docker.generic.nodes.GenericContainer
      metadata:
        task: preprocessing
      properties:
        auto_remove: false
        cleanup: false
        detach: false
        image: {get_input: preprocessing_image}
        keep_volumes: true
        restart_policy: no
        cpu_share: 1.0
        mem_share: "128 MB"
        volumes: {get_input: preprocessing_volumes}
        # docker_env_vars:  {get_input: preprocessing_environment_variables}
        docker_env_vars:  {concat: ["{\"WPS_START_DATE\": \"", get_input: preprocessing_start_date, "\", \"WPS_END_DATE\": \"", get_input: preprocessing_end_date, "\", \"WPS_MODE\": \"WARMUP\"}"]}
      requirements:
        - hostedOnContainerRuntimeDockerHost:
            type_requirement: host
            node: Docker
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    GFSData:
      type: org.lexis.nodes.GFSData
      properties:
        start_date: {get_input: preprocessing_start_date}
        end_date: {get_input: preprocessing_end_date}
        number_of_past_days: 2
        with_data_assimilation: false
        left_longitude: "-19.0"
        right_longitude: "48.0"
        top_latitude: "64.0"
        bottom_latitude: "24.0"
        output_directory: "/wps_data/gfs"
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    GEOGData:
      type: org.lexis.nodes.GEOGData
      properties:
        output_directory: "/wps_data/geog"
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    WRF_DAY_3:
      type: org.heappe.nodes.Job
      metadata:
        task: computation
      properties:
        JobSpecification:
          Name: WRFJob
          Project: "DD-19-14"
          ClusterId: 2
          Tasks:
            - Name: WRFTask
              ClusterNodeTypeId: 7
              CommandTemplateId: 9
              TemplateParameterValues:
                - CommandParameterIdentifier: MPICores
                  ParameterValue: "48"
              WalltimeLimit: 36000
              MinCores: 48
              MaxCores: 48
              Priority: 4
              EnvironmentVariables:
                - Name: HDF5
                  Value: "./deps"
                - Name: NETCDF
                  Value: "./deps"
                - Name: CPPFLAGS
                  Value: "-I./deps/include"
                - Name: CFLAGS
                  Value: "-I./deps/include"
                - Name: CXXFLAGS
                  Value: "-I./deps/include"
                - Name: FCFLAGS
                  Value: "-I./deps/include"
                - Name: FFLAGS
                  Value: "-I./deps/include"
                - Name: LDFLAGS
                  Value: "-L./deps/lib"
                - Name: WRFIO_NCD_LARGE_FILE_SUPPORT
                  Value: "1"
                - Name: LD_LIBRARY_PATH
                  Value: "$LD_LIBRARY_PATH:./deps/lib"
                - Name: JASPERLIB
                  Value: "./deps/lib"
                - Name: JASPERINC
                  Value: "./deps/include"
              StandardOutputFile: "stdout"
              StandardErrorFile: "stderr"
              ProgressFile: "stdprog"
              LogFile: "stdlog"
    WRF_DAY_2:
      type: org.heappe.nodes.Job
      metadata:
        task: computation
      properties:
        JobSpecification:
          Name: WRFJob
          Project: "DD-19-14"
          ClusterId: 2
          Tasks:
            - Name: WRFTask
              ClusterNodeTypeId: 7
              CommandTemplateId: 9
              TemplateParameterValues:
                - CommandParameterIdentifier: MPICores
                  ParameterValue: "48"
              WalltimeLimit: 36000
              MinCores: 48
              MaxCores: 48
              Priority: 4
              EnvironmentVariables:
                - Name: HDF5
                  Value: "./deps"
                - Name: NETCDF
                  Value: "./deps"
                - Name: CPPFLAGS
                  Value: "-I./deps/include"
                - Name: CFLAGS
                  Value: "-I./deps/include"
                - Name: CXXFLAGS
                  Value: "-I./deps/include"
                - Name: FCFLAGS
                  Value: "-I./deps/include"
                - Name: FFLAGS
                  Value: "-I./deps/include"
                - Name: LDFLAGS
                  Value: "-L./deps/lib"
                - Name: WRFIO_NCD_LARGE_FILE_SUPPORT
                  Value: "1"
                - Name: LD_LIBRARY_PATH
                  Value: "$LD_LIBRARY_PATH:./deps/lib"
                - Name: JASPERLIB
                  Value: "./deps/lib"
                - Name: JASPERINC
                  Value: "./deps/include"
              StandardOutputFile: "stdout"
              StandardErrorFile: "stderr"
              ProgressFile: "stdprog"
              LogFile: "stdlog"
    WRF_DAY_1:
      type: org.heappe.nodes.Job
      metadata:
        task: computation
      properties:
        JobSpecification:
          Name: WRFJob
          Project: "DD-19-14"
          ClusterId: 2
          Tasks:
            - Name: WRFTask
              ClusterNodeTypeId: 7
              CommandTemplateId: 9
              TemplateParameterValues:
                - CommandParameterIdentifier: MPICores
                  ParameterValue: "48"
              WalltimeLimit: 36000
              MinCores: 48
              MaxCores: 48
              Priority: 4
              EnvironmentVariables:
                - Name: HDF5
                  Value: "./deps"
                - Name: NETCDF
                  Value: "./deps"
                - Name: CPPFLAGS
                  Value: "-I./deps/include"
                - Name: CFLAGS
                  Value: "-I./deps/include"
                - Name: CXXFLAGS
                  Value: "-I./deps/include"
                - Name: FCFLAGS
                  Value: "-I./deps/include"
                - Name: FFLAGS
                  Value: "-I./deps/include"
                - Name: LDFLAGS
                  Value: "-L./deps/lib"
                - Name: WRFIO_NCD_LARGE_FILE_SUPPORT
                  Value: "1"
                - Name: LD_LIBRARY_PATH
                  Value: "$LD_LIBRARY_PATH:./deps/lib"
                - Name: JASPERLIB
                  Value: "./deps/lib"
                - Name: JASPERINC
                  Value: "./deps/include"
              StandardOutputFile: "stdout"
              StandardErrorFile: "stderr"
              ProgressFile: "stdprog"
              LogFile: "stdlog"
    CopyDay3DataToJobTask:
      type: org.lexis.datatransfer.nodes.CopySubDirToJobTask
      properties:
        task_name: WRFTask
        parent_directory: {get_input: preprocessing_output_directory}
        subdirectory_index: 2
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_3
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.SendInputsToJob
    CopyDay2DataToJobTask:
      type: org.lexis.datatransfer.nodes.CopySubDirToJobTask
      properties:
        task_name: WRFTask
        parent_directory: {get_input: preprocessing_output_directory}
        subdirectory_index: 1
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_2
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.SendInputsToJob
    CopyDay1DataToJobTask:
      type: org.lexis.datatransfer.nodes.CopySubDirToJobTask
      properties:
        task_name: WRFTask
        parent_directory: {get_input: preprocessing_output_directory}
        subdirectory_index: 0
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_1
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.SendInputsToJob
    CopyWRFDay3FromJobTask:
      type: org.lexis.datatransfer.nodes.CopyFromJobTask
      properties:
        task_name: WRFTask
        source_files_patterns: [ "auxhist*" ]
        destination_directory:  { concat: [get_input: postprocessing_input_directory, "/wrf/3"] }
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_3
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.GetResultsFromJob
    CopyWRFDay2FromJobTask:
      type: org.lexis.datatransfer.nodes.CopyFromJobTask
      properties:
        task_name: WRFTask
        source_files_patterns: [ "auxhist*" ]
        destination_directory:  { concat: [get_input: postprocessing_input_directory, "/wrf/2"] }
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_2
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.GetResultsFromJob
    CopyWRFDay1FromJobTask:
      type: org.lexis.datatransfer.nodes.CopyFromJobTask
      properties:
        task_name: WRFTask
        source_files_patterns: [ "auxhist*" ]
        destination_directory:  { concat: [get_input: postprocessing_input_directory, "/wrf/1"] }
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
        - job:
            type_requirement: job
            node: WRF_DAY_1
            capability: org.heappe.capabilities.HeappeJob
            relationship: org.heappe.relationships.GetResultsFromJob
    DeletePreProcessDirs:
      type: org.lexis.datatransfer.nodes.DeleteDirectories
      properties:
        directories: {get_input: preprocessing_volumes}
      requirements:
        - hostedOnVirtualMachineHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    Webdrops:
      type: org.lexis.nodes.Webdrops
      properties:
        start_date: { concat: [get_input: postprocessing_risico_run_date, "00"] }
        download_type: "RISICO"
        destination: { concat: [get_input: postprocessing_input_directory, "/observations"] }
        auth_url: "https://testauth.cimafoundation.org/auth/realms/webdrops/protocol/openid-connect/token"
        url: "http://webdrops.cimafoundation.org/app/"
      requirements:
        - hostedOnComputeHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    RISICO:
      type: org.ystia.docker.containers.docker.generic.nodes.GenericContainer
      metadata:
        task: postprocessing
      properties:
        auto_remove: false
        cleanup: false
        detach: false
        image: {get_input: postprocessing_image}
        keep_volumes: true
        restart_policy: no
        cpu_share: 1.0
        mem_share: "128 MB"
        volumes: {get_input: postprocessing_volumes}
        # docker_env_vars:  {get_input: postprocessing_environment_variables}
        docker_env_vars:  {concat: ["{\"RISICO_RUN_DATE\": \"", get_input: postprocessing_risico_run_date, "0000\"}"]}
      requirements:
        - hostedOnContainerRuntimeDockerHost:
            type_requirement: host
            node: Docker
            capability: org.alien4cloud.extended.container.capabilities.ApplicationHost
            relationship: org.alien4cloud.extended.container.relationships.HostedOnContainerRuntime
      capabilities:
        scalable:
          properties:
            min_instances: 1
            max_instances: 1
            default_instances: 1
    EnableCloudAcessJob:
      type: org.ddi.nodes.EnableCloudStagingAreaAccessJob
      properties:
        token: { get_input: token }
      requirements:
        - sameSiteComputeOs:
            type_requirement: os
            node: RisicoVM
            capability: tosca.capabilities.OperatingSystem
            relationship: org.ddi.relationships.SameSite
    DisableCloudAcessJob:
      type: org.ddi.nodes.DisableCloudStagingAreaAccessJob
      properties:
        token: { get_input: token }
      requirements:
        - sameSiteComputeOs:
            type_requirement: os
            node: RisicoVM
            capability: tosca.capabilities.OperatingSystem
            relationship: org.ddi.relationships.SameSite
    MountStagingArea:
      type: org.lexis.datatransfer.nodes.MountStagingArea
      properties:
        mount_point: "/mnt/cloud_staging_area"
        user_name: lexisclouduser
        group_name: lexiscloudgroup
      requirements:
        - mountCloudStagingAreaEnableCloudAcessJobCloud_staging_area_access:
            type_requirement: cloud_staging_area_access
            node: EnableCloudAcessJob
            capability: org.ddi.capabilities.CloudStagingAreaAccess
            relationship: org.lexis.datatransfer.relationships.MountCloudStagingArea
        - hostedOnComputeHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    CreateStagingAreaResultDir:
      type: org.lexis.datatransfer.nodes.CreateStagingAreaDirectory
      properties:
        directory: "risico_results"
        create_timestamp_destination_subdirectory: true
      requirements:
        - mountedCloudStagingArea:
            type_requirement: mounted_staging_area
            node: MountStagingArea
            capability: org.lexis.datatransfer.capabilities.MountedStagingAreaAccess
            relationship: org.lexis.datatransfer.relationships.MountedCloudStagingArea
        - hostedOnComputeHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    StageWRFResults:
      type: org.lexis.datatransfer.nodes.CopyToStagingAreaDirectory
      properties:
        source_directory: { concat: [get_input: postprocessing_input_directory, "/wrf"] }
        destination_subdirectory: "wrf"
      requirements:
        - staging_area_directory:
            type_requirement: cloud_area_directory_provider
            node: CreateStagingAreaResultDir
            capability: org.ddi.capabilities.CloudAreaDirectoryProvider
            relationship: org.ddi.relationships.CloudAreaDirectoryProvider
        - hostedOnComputeHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    StageRISICOResults:
      type: org.lexis.datatransfer.nodes.CopyToStagingAreaDirectory
      properties:
        source_directory: {concat: [get_input: postprocessing_input_directory, "/output"]}
        destination_subdirectory: "risico"
      requirements:
        - staging_area_directory:
            type_requirement: cloud_area_directory_provider
            node: CreateStagingAreaResultDir
            capability: org.ddi.capabilities.CloudAreaDirectoryProvider
            relationship: org.ddi.relationships.CloudAreaDirectoryProvider
        - hostedOnComputeHost:
            type_requirement: host
            node: RisicoVM
            capability: tosca.capabilities.Container
            relationship: tosca.relationships.HostedOn
    CloudToDDIJob:
      type: org.ddi.nodes.CloudToDDIJob
      properties:
        metadata: {concat: ["{\"creator\": [\"RISICO workflow\"], \"contributor\": [\"RISICO workflow\"], \"publisher\": [\"RISICO workflow\"], \"resourceType\": \"Workflow result\", \"title\": \"RISICO Workflow result - ", get_input: postprocessing_risico_run_date, "\"}"]}
        token: { get_input: token }
        ddi_path: { get_input: postprocessing_ddi_path }
      requirements:
        - cloud_area_directory_provider:
            type_requirement: cloud_area_directory_provider
            node: CreateStagingAreaResultDir
            capability: org.ddi.capabilities.CloudAreaDirectoryProvider
            relationship: org.ddi.relationships.CloudAreaDirectoryProvider
    DeleteCloudDataJob:
      type: org.ddi.nodes.DeleteCloudDataJob
      properties:
        token: { get_input: token }
      requirements:
        - cloud_area_directory_provider:
            type_requirement: cloud_area_directory_provider
            node: CreateStagingAreaResultDir
            capability: org.ddi.capabilities.CloudAreaDirectoryProvider
            relationship: org.ddi.relationships.CloudAreaDirectoryProvider
  outputs:
    ddi_post_process_results:
      description: DDI path to RISICO post-processing results
      value: { get_attribute: [ CloudToDDIJob, destination_directory_path ] }
  workflows:
    install:
      steps:
        Network_install:
          target: PublicNet
          activities:
            - delegate: install
    uninstall:
      steps:
        Network_uninstall:
          target: PublicNet
          activities:
            - delegate: uninstall
    Run:
      steps:
        Compute_install:
          target: RisicoVM
          activities:
            - delegate: install
          on_success:
            - CreatePreProcessDirs_start
        CreatePreProcessDirs_start:
          target: CreatePreProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - CreatePreProcessDirs_started
        CreatePreProcessDirs_started:
          target: CreatePreProcessDirs
          activities:
            - set_state: started
          on_success:
            - GFSData_download
            - GEOGData_download
            - EnableCloudAcessJob_create
        GFSData_download:
          target: GFSData
          activities:
            - call_operation: custom.download
          on_success:
            - GFSData_done
        GFSData_done:
          target: GFSData
          activities:
            - set_state: started
          on_success:
            - Docker_create
        GEOGData_download:
          target: GEOGData
          activities:
            - call_operation: custom.download
          on_success:
            - GEOGData_done
        GEOGData_done:
          target: GEOGData
          activities:
            - set_state: started
          on_success:
            - Docker_create
        EnableCloudAcessJob_create:
          target: EnableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - EnableCloudAcessJob_submit
        EnableCloudAcessJob_submit:
          target: EnableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - EnableCloudAcessJob_submitted
        EnableCloudAcessJob_submitted:
          target: EnableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - EnableCloudAcessJob_run
        EnableCloudAcessJob_run:
          target: EnableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - EnableCloudAcessJob_executed
        EnableCloudAcessJob_executed:
          target: EnableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - MountStagingArea_create
        MountStagingArea_create:
          target: MountStagingArea
          activities:
            - call_operation: Standard.create
          on_success:
            - MountStagingArea_created
        MountStagingArea_created:
          target: MountStagingArea
          activities:
            - set_state: created
          on_success:
            - MountStagingArea_start
        MountStagingArea_start:
          target: MountStagingArea
          activities:
            - call_operation: Standard.start
          on_success:
            - MountStagingArea_started
        MountStagingArea_started:
          target: MountStagingArea
          activities:
            - set_state: started
          on_success:
            - Docker_create
            - CreateStagingAreaResultDir_start
        CreateStagingAreaResultDir_start:
          target: CreateStagingAreaResultDir
          activities:
            - call_operation: Standard.start
          on_success:
            - CreateStagingAreaResultDir_started
        CreateStagingAreaResultDir_started:
          target: CreateStagingAreaResultDir
          activities:
            - set_state: started
          on_success:
            - StageWRFResults_start
        Docker_create:
          target: Docker
          activities:
            - call_operation: Standard.create
          on_success:
            - Docker_configure
        Docker_configure:
          target: Docker
          activities:
            - call_operation: Standard.configure
          on_success:
            - Docker_start
        Docker_start:
          target: Docker
          activities:
            - call_operation: Standard.start
          on_success:
            - Docker_started
        Docker_started:
          target: Docker
          activities:
            - set_state: started
          on_success:
            - WPS_GFS_create
        WPS_GFS_create:
          target: WPS_GFS
          activities:
            - call_operation: Standard.create
          on_success:
            - WPS_GFS_start
        WPS_GFS_start:
          target: WPS_GFS
          activities:
            - call_operation: Standard.start
          on_success:
            - WPS_GFS_started
        WPS_GFS_started:
          target: WPS_GFS
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_1_create
            - WRF_DAY_2_create
            - WRF_DAY_3_create
        WRF_DAY_1_create:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_1_enable_file_transfer
        WRF_DAY_2_create:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_2_enable_file_transfer
        WRF_DAY_3_create:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_3_enable_file_transfer
        WRF_DAY_1_enable_file_transfer:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay1ToJobTask_start
        WRF_DAY_2_enable_file_transfer:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay2ToJobTask_start
        WRF_DAY_3_enable_file_transfer:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay3ToJobTask_start
        CopyDay1ToJobTask_start:
          target: CopyDay1DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay1ToJobTask_started
        CopyDay1ToJobTask_started:
          target: CopyDay1DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_1_submit
        CopyDay2ToJobTask_start:
          target: CopyDay2DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay2ToJobTask_started
        CopyDay2ToJobTask_started:
          target: CopyDay2DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_2_submit
        CopyDay3ToJobTask_start:
          target: CopyDay3DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay3ToJobTask_started
        CopyDay3ToJobTask_started:
          target: CopyDay3DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_3_submit
        WRF_DAY_1_submit:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_1_submitted
        WRF_DAY_1_submitted:
          target: WRF_DAY_1
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_1_run
        WRF_DAY_1_run:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_1_executed
        WRF_DAY_1_executed:
          target: WRF_DAY_1
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        WRF_DAY_2_submit:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_2_submitted
        WRF_DAY_2_submitted:
          target: WRF_DAY_2
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_2_run
        WRF_DAY_2_run:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_2_executed
        WRF_DAY_2_executed:
          target: WRF_DAY_2
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        WRF_DAY_3_submit:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_3_submitted
        WRF_DAY_3_submitted:
          target: WRF_DAY_3
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_3_run
        WRF_DAY_3_run:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_3_executed
        WRF_DAY_3_executed:
          target: WRF_DAY_3
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        DeletePreProcessDirs_start:
          target: DeletePreProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - DeletePreProcessDirs_started
        DeletePreProcessDirs_started:
          target: DeletePreProcessDirs
          activities:
            - set_state: started
        CreatePostProcessDirs_start:
          target: CreatePostProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - CreatePostProcessDirs_started
        CreatePostProcessDirs_started:
          target: CreatePostProcessDirs
          activities:
            - set_state: started
          on_success:
            - CopyWRFDay1FromJobTask_start
            - CopyWRFDay2FromJobTask_start
            - CopyWRFDay3FromJobTask_start
            - Webdrops_start
        Webdrops_start:
          target: Webdrops
          activities:
            - call_operation: Standard.start
          on_success:
            - Webdrops_started
        Webdrops_started:
          target: Webdrops
          activities:
            - set_state: started
          on_success:
            - RISICO_create
        CopyWRFDay1FromJobTask_start:
          target: CopyWRFDay1FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay1FromJobTask_started
        CopyWRFDay1FromJobTask_started:
          target: CopyWRFDay1FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_1_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay2FromJobTask_start:
          target: CopyWRFDay2FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay2FromJobTask_started
        CopyWRFDay2FromJobTask_started:
          target: CopyWRFDay2FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_2_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay3FromJobTask_start:
          target: CopyWRFDay3FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay3FromJobTask_started
        CopyWRFDay3FromJobTask_started:
          target: CopyWRFDay3FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_3_disable_file_transfer
            - StageWRFResults_start
        StageWRFResults_start:
          target: StageWRFResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageWRFResults_started
        StageWRFResults_started:
          target: StageWRFResults
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        WRF_DAY_1_disable_file_transfer:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_1_delete
        WRF_DAY_1_delete:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_1_deleted
        WRF_DAY_1_deleted:
          target: WRF_DAY_1
          activities:
            - set_state: deleted
        WRF_DAY_2_disable_file_transfer:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_2_delete
        WRF_DAY_2_delete:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_2_deleted
        WRF_DAY_2_deleted:
          target: WRF_DAY_2
          activities:
            - set_state: deleted
        WRF_DAY_3_disable_file_transfer:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_3_delete
        WRF_DAY_3_delete:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_3_deleted
        WRF_DAY_3_deleted:
          target: WRF_DAY_3
          activities:
            - set_state: deleted
        RISICO_create:
          target: RISICO
          activities:
            - call_operation: Standard.create
          on_success:
            - RISICO_start
        RISICO_start:
          target: RISICO
          activities:
            - call_operation: Standard.start
          on_success:
            - RISICO_started
        RISICO_started:
          target: RISICO
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        StageRISICOResults_start:
          target: StageRISICOResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageRISICOResults_started
        StageRISICOResults_started:
          target: StageRISICOResults
          activities:
            - set_state: started
          on_success:
            - CloudToDDIJob_create
        CloudToDDIJob_create:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - CloudToDDIJob_submit
        CloudToDDIJob_submit:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - CloudToDDIJob_submitted
        CloudToDDIJob_submitted:
          target: CloudToDDIJob
          activities:
            - set_state: submitted
          on_success:
            - CloudToDDIJob_run
        CloudToDDIJob_run:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - CloudToDDIJob_executed
        CloudToDDIJob_executed:
          target: CloudToDDIJob
          activities:
            - set_state: executed
          on_success:
            - DeleteCloudDataJob_create
        DeleteCloudDataJob_create:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DeleteCloudDataJob_created
        DeleteCloudDataJob_created:
          target: DeleteCloudDataJob
          activities:
            - set_state: created
          on_success:
            - DeleteCloudDataJob_submit
        DeleteCloudDataJob_submit:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DeleteCloudDataJob_submitted
        DeleteCloudDataJob_submitted:
          target: DeleteCloudDataJob
          activities:
            - set_state: submitted
          on_success:
            - DeleteCloudDataJob_run
        DeleteCloudDataJob_run:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DeleteCloudDataJob_executed
        DeleteCloudDataJob_executed:
          target: DeleteCloudDataJob
          activities:
            - set_state: executed
          on_success:
            - DisableCloudAcessJob_create
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - Compute_uninstall
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
    cleanupRun:
      steps:
        DeleteCloudDataJob_create:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DeleteCloudDataJob_created
        DeleteCloudDataJob_created:
          target: DeleteCloudDataJob
          activities:
            - set_state: created
          on_success:
            - DeleteCloudDataJob_submit
        DeleteCloudDataJob_submit:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DeleteCloudDataJob_submitted
        DeleteCloudDataJob_submitted:
          target: DeleteCloudDataJob
          activities:
            - set_state: submitted
          on_success:
            - DeleteCloudDataJob_run
        DeleteCloudDataJob_run:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DeleteCloudDataJob_executed
        DeleteCloudDataJob_executed:
          target: DeleteCloudDataJob
          activities:
            - set_state: executed
          on_success:
            - DisableCloudAcessJob_create
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - Compute_uninstall
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
    testRun:
      steps:
        WRF_DAY_1_create:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_1_enable_file_transfer
        WRF_DAY_2_create:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_2_enable_file_transfer
        WRF_DAY_3_create:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - WRF_DAY_3_enable_file_transfer
        WRF_DAY_1_enable_file_transfer:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay1ToJobTask_start
        WRF_DAY_2_enable_file_transfer:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay2ToJobTask_start
        WRF_DAY_3_enable_file_transfer:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.enable_file_transfer
          on_success:
            - CopyDay3ToJobTask_start
        CopyDay1ToJobTask_start:
          target: CopyDay1DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay1ToJobTask_started
        CopyDay1ToJobTask_started:
          target: CopyDay1DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_1_submit
        CopyDay2ToJobTask_start:
          target: CopyDay2DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay2ToJobTask_started
        CopyDay2ToJobTask_started:
          target: CopyDay2DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_2_submit
        CopyDay3ToJobTask_start:
          target: CopyDay3DataToJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyDay3ToJobTask_started
        CopyDay3ToJobTask_started:
          target: CopyDay3DataToJobTask
          activities:
            - set_state: started
          on_success:
            - WRF_DAY_3_submit
        WRF_DAY_1_submit:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_1_submitted
        WRF_DAY_1_submitted:
          target: WRF_DAY_1
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_1_run
        WRF_DAY_1_run:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_1_executed
        WRF_DAY_1_executed:
          target: WRF_DAY_1
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        WRF_DAY_2_submit:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_2_submitted
        WRF_DAY_2_submitted:
          target: WRF_DAY_2
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_2_run
        WRF_DAY_2_run:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_2_executed
        WRF_DAY_2_executed:
          target: WRF_DAY_2
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        WRF_DAY_3_submit:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - WRF_DAY_3_submitted
        WRF_DAY_3_submitted:
          target: WRF_DAY_3
          activities:
            - set_state: submitted
          on_success:
            - WRF_DAY_3_run
        WRF_DAY_3_run:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - WRF_DAY_3_executed
        WRF_DAY_3_executed:
          target: WRF_DAY_3
          activities:
            - set_state: executed
          on_success:
            - DeletePreProcessDirs_start
            - CreatePostProcessDirs_start
        DeletePreProcessDirs_start:
          target: DeletePreProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - DeletePreProcessDirs_started
        DeletePreProcessDirs_started:
          target: DeletePreProcessDirs
          activities:
            - set_state: started
        CreatePostProcessDirs_start:
          target: CreatePostProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - CreatePostProcessDirs_started
        CreatePostProcessDirs_started:
          target: CreatePostProcessDirs
          activities:
            - set_state: started
          on_success:
            - CopyWRFDay1FromJobTask_start
            - CopyWRFDay2FromJobTask_start
            - CopyWRFDay3FromJobTask_start
            - Webdrops_start
        Webdrops_start:
          target: Webdrops
          activities:
            - call_operation: Standard.start
          on_success:
            - Webdrops_started
        Webdrops_started:
          target: Webdrops
          activities:
            - set_state: started
          on_success:
            - RISICO_create
        CopyWRFDay1FromJobTask_start:
          target: CopyWRFDay1FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay1FromJobTask_started
        CopyWRFDay1FromJobTask_started:
          target: CopyWRFDay1FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_1_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay2FromJobTask_start:
          target: CopyWRFDay2FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay2FromJobTask_started
        CopyWRFDay2FromJobTask_started:
          target: CopyWRFDay2FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_2_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay3FromJobTask_start:
          target: CopyWRFDay3FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay3FromJobTask_started
        CopyWRFDay3FromJobTask_started:
          target: CopyWRFDay3FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_3_disable_file_transfer
            - StageWRFResults_start
        StageWRFResults_start:
          target: StageWRFResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageWRFResults_started
        StageWRFResults_started:
          target: StageWRFResults
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        WRF_DAY_1_disable_file_transfer:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_1_delete
        WRF_DAY_1_delete:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_1_deleted
        WRF_DAY_1_deleted:
          target: WRF_DAY_1
          activities:
            - set_state: deleted
        WRF_DAY_2_disable_file_transfer:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_2_delete
        WRF_DAY_2_delete:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_2_deleted
        WRF_DAY_2_deleted:
          target: WRF_DAY_2
          activities:
            - set_state: deleted
        WRF_DAY_3_disable_file_transfer:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_3_delete
        WRF_DAY_3_delete:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_3_deleted
        WRF_DAY_3_deleted:
          target: WRF_DAY_3
          activities:
            - set_state: deleted
        RISICO_create:
          target: RISICO
          activities:
            - call_operation: Standard.create
          on_success:
            - RISICO_start
        RISICO_start:
          target: RISICO
          activities:
            - call_operation: Standard.start
          on_success:
            - RISICO_started
        RISICO_started:
          target: RISICO
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        StageRISICOResults_start:
          target: StageRISICOResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageRISICOResults_started
        StageRISICOResults_started:
          target: StageRISICOResults
          activities:
            - set_state: started
          on_success:
            - CloudToDDIJob_create
        CloudToDDIJob_create:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - CloudToDDIJob_submit
        CloudToDDIJob_submit:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - CloudToDDIJob_submitted
        CloudToDDIJob_submitted:
          target: CloudToDDIJob
          activities:
            - set_state: submitted
          on_success:
            - CloudToDDIJob_run
        CloudToDDIJob_run:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - CloudToDDIJob_executed
        CloudToDDIJob_executed:
          target: CloudToDDIJob
          activities:
            - set_state: executed
          on_success:
            - DeleteCloudDataJob_create
        DeleteCloudDataJob_create:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DeleteCloudDataJob_created
        DeleteCloudDataJob_created:
          target: DeleteCloudDataJob
          activities:
            - set_state: created
          on_success:
            - DeleteCloudDataJob_submit
        DeleteCloudDataJob_submit:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DeleteCloudDataJob_submitted
        DeleteCloudDataJob_submitted:
          target: DeleteCloudDataJob
          activities:
            - set_state: submitted
          on_success:
            - DeleteCloudDataJob_run
        DeleteCloudDataJob_run:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DeleteCloudDataJob_executed
        DeleteCloudDataJob_executed:
          target: DeleteCloudDataJob
          activities:
            - set_state: executed
          on_success:
            - DisableCloudAcessJob_create
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - Compute_uninstall
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
    testpostprocess:
      steps:
        RISICO_create:
          target: RISICO
          activities:
            - call_operation: Standard.create
          on_success:
            - RISICO_start
        RISICO_start:
          target: RISICO
          activities:
            - call_operation: Standard.start
          on_success:
            - RISICO_started
        RISICO_started:
          target: RISICO
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        StageRISICOResults_start:
          target: StageRISICOResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageRISICOResults_started
        StageRISICOResults_started:
          target: StageRISICOResults
          activities:
            - set_state: started
          on_success:
            - CloudToDDIJob_create
        CloudToDDIJob_create:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - CloudToDDIJob_submit
        CloudToDDIJob_submit:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - CloudToDDIJob_submitted
        CloudToDDIJob_submitted:
          target: CloudToDDIJob
          activities:
            - set_state: submitted
          on_success:
            - CloudToDDIJob_run
        CloudToDDIJob_run:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - CloudToDDIJob_executed
        CloudToDDIJob_executed:
          target: CloudToDDIJob
          activities:
            - set_state: executed
          on_success:
            - DeleteCloudDataJob_create
        DeleteCloudDataJob_create:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DeleteCloudDataJob_created
        DeleteCloudDataJob_created:
          target: DeleteCloudDataJob
          activities:
            - set_state: created
          on_success:
            - DeleteCloudDataJob_submit
        DeleteCloudDataJob_submit:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DeleteCloudDataJob_submitted
        DeleteCloudDataJob_submitted:
          target: DeleteCloudDataJob
          activities:
            - set_state: submitted
          on_success:
            - DeleteCloudDataJob_run
        DeleteCloudDataJob_run:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DeleteCloudDataJob_executed
        DeleteCloudDataJob_executed:
          target: DeleteCloudDataJob
          activities:
            - set_state: executed
          on_success:
            - DisableCloudAcessJob_create
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - Compute_uninstall
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
    testcomputeuninstall:
      steps:
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
          on_success:
            - Network_uninstall
        Network_uninstall:
          target: PublicNet
          activities:
            - delegate: uninstall
    testdisablecloudaccess:
      steps:
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
    testdeletewrf:
      steps:
        WRF_DAY_1_delete:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_1_deleted
        WRF_DAY_1_deleted:
          target: WRF_DAY_1
          activities:
            - set_state: deleted
        WRF_DAY_2_delete:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_2_deleted
        WRF_DAY_2_deleted:
          target: WRF_DAY_2
          activities:
            - set_state: deleted
        WRF_DAY_3_delete:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_3_deleted
        WRF_DAY_3_deleted:
          target: WRF_DAY_3
          activities:
            - set_state: deleted
    testrisico:
      steps:
        RISICO_create:
          target: RISICO
          activities:
            - call_operation: Standard.create
          on_success:
            - RISICO_start
        RISICO_start:
          target: RISICO
          activities:
            - call_operation: Standard.start
          on_success:
            - RISICO_started
        RISICO_started:
          target: RISICO
          activities:
            - set_state: started
    testPostRun:
      steps:
        DeletePreProcessDirs_start:
          target: DeletePreProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - DeletePreProcessDirs_started
        DeletePreProcessDirs_started:
          target: DeletePreProcessDirs
          activities:
            - set_state: started
        CreatePostProcessDirs_start:
          target: CreatePostProcessDirs
          activities:
            - call_operation: Standard.start
          on_success:
            - CreatePostProcessDirs_started
        CreatePostProcessDirs_started:
          target: CreatePostProcessDirs
          activities:
            - set_state: started
          on_success:
            - CopyWRFDay1FromJobTask_start
            - CopyWRFDay2FromJobTask_start
            - CopyWRFDay3FromJobTask_start
            - Webdrops_start
        Webdrops_start:
          target: Webdrops
          activities:
            - call_operation: Standard.start
          on_success:
            - Webdrops_started
        Webdrops_started:
          target: Webdrops
          activities:
            - set_state: started
          on_success:
            - RISICO_create
        CopyWRFDay1FromJobTask_start:
          target: CopyWRFDay1FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay1FromJobTask_started
        CopyWRFDay1FromJobTask_started:
          target: CopyWRFDay1FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_1_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay2FromJobTask_start:
          target: CopyWRFDay2FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay2FromJobTask_started
        CopyWRFDay2FromJobTask_started:
          target: CopyWRFDay2FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_2_disable_file_transfer
            - StageWRFResults_start
        CopyWRFDay3FromJobTask_start:
          target: CopyWRFDay3FromJobTask
          activities:
            - call_operation: Standard.start
          on_success:
            - CopyWRFDay3FromJobTask_started
        CopyWRFDay3FromJobTask_started:
          target: CopyWRFDay3FromJobTask
          activities:
            - set_state: started
          on_success:
            - RISICO_create
            - WRF_DAY_3_disable_file_transfer
            - StageWRFResults_start
        StageWRFResults_start:
          target: StageWRFResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageWRFResults_started
        StageWRFResults_started:
          target: StageWRFResults
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        WRF_DAY_1_disable_file_transfer:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_1_delete
        WRF_DAY_1_delete:
          target: WRF_DAY_1
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_1_deleted
        WRF_DAY_1_deleted:
          target: WRF_DAY_1
          activities:
            - set_state: deleted
        WRF_DAY_2_disable_file_transfer:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_2_delete
        WRF_DAY_2_delete:
          target: WRF_DAY_2
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_2_deleted
        WRF_DAY_2_deleted:
          target: WRF_DAY_2
          activities:
            - set_state: deleted
        WRF_DAY_3_disable_file_transfer:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: custom.disable_file_transfer
          on_success:
            - WRF_DAY_3_delete
        WRF_DAY_3_delete:
          target: WRF_DAY_3
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.delete
          on_success:
            - WRF_DAY_3_deleted
        WRF_DAY_3_deleted:
          target: WRF_DAY_3
          activities:
            - set_state: deleted
        RISICO_create:
          target: RISICO
          activities:
            - call_operation: Standard.create
          on_success:
            - RISICO_start
        RISICO_start:
          target: RISICO
          activities:
            - call_operation: Standard.start
          on_success:
            - RISICO_started
        RISICO_started:
          target: RISICO
          activities:
            - set_state: started
          on_success:
            - StageRISICOResults_start
        StageRISICOResults_start:
          target: StageRISICOResults
          activities:
            - call_operation: Standard.start
          on_success:
            - StageRISICOResults_started
        StageRISICOResults_started:
          target: StageRISICOResults
          activities:
            - set_state: started
          on_success:
            - CloudToDDIJob_create
        CloudToDDIJob_create:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - CloudToDDIJob_submit
        CloudToDDIJob_submit:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - CloudToDDIJob_submitted
        CloudToDDIJob_submitted:
          target: CloudToDDIJob
          activities:
            - set_state: submitted
          on_success:
            - CloudToDDIJob_run
        CloudToDDIJob_run:
          target: CloudToDDIJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - CloudToDDIJob_executed
        CloudToDDIJob_executed:
          target: CloudToDDIJob
          activities:
            - set_state: executed
          on_success:
            - DeleteCloudDataJob_create
        DeleteCloudDataJob_create:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DeleteCloudDataJob_created
        DeleteCloudDataJob_created:
          target: DeleteCloudDataJob
          activities:
            - set_state: created
          on_success:
            - DeleteCloudDataJob_submit
        DeleteCloudDataJob_submit:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DeleteCloudDataJob_submitted
        DeleteCloudDataJob_submitted:
          target: DeleteCloudDataJob
          activities:
            - set_state: submitted
          on_success:
            - DeleteCloudDataJob_run
        DeleteCloudDataJob_run:
          target: DeleteCloudDataJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DeleteCloudDataJob_executed
        DeleteCloudDataJob_executed:
          target: DeleteCloudDataJob
          activities:
            - set_state: executed
          on_success:
            - DisableCloudAcessJob_create
        DisableCloudAcessJob_create:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: Standard.create
          on_success:
            - DisableCloudAcessJob_submit
        DisableCloudAcessJob_submit:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - DisableCloudAcessJob_submitted
        DisableCloudAcessJob_submitted:
          target: DisableCloudAcessJob
          activities:
            - set_state: submitted
          on_success:
            - DisableCloudAcessJob_run
        DisableCloudAcessJob_run:
          target: DisableCloudAcessJob
          operation_host: ORCHESTRATOR
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
          on_success:
            - DisableCloudAcessJob_executed
        DisableCloudAcessJob_executed:
          target: DisableCloudAcessJob
          activities:
            - set_state: executed
          on_success:
            - Compute_uninstall
        Compute_uninstall:
          target: RisicoVM
          activities:
            - delegate: uninstall
    start:
      steps:
        start_step:
          target: PublicNet
          activities:
            - set_state: started
    stop:
      steps:
        stop_step:
          target: PublicNet
          activities:
            - set_state: stopped
    cancel:
      steps:
        start_step:
          target: PublicNet
          activities:
            - set_state: canceled
